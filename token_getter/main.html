<!DOCTYPE html>

<head>
    <meta charset="utf-8">
    <title>获取refresh_token</title>
</head>

<body>
    <main>
        <h1>获取refresh_token</h1>
        <h2>要求</h2>
        <ul>
            <li>有一个现代浏览器，如Edge, Chrome, Firefox</li>
            <li>会打开浏览器的开发者工具；有的开发者工具界面为英文，下述皆为中文，请自行辨认对应英文</li>
            <li>能够访问Pixiv</li>
        </ul>

        <h2>具体步骤</h2>
        <ul>
            <li>访问 <a href="[% login_url %]" target="_blank">Pixiv登录页面</a></li>
            <li>
                打开浏览器的开发者工具，切换至【网络】标签，开启【持续记录】
                <blockquote>
                    在Firefox中，【持续记录】在【网络】标签右上方的齿轮图标中<br>
                    在Edge和Chrome中，【持续记录】被叫做【保留日志】<br>
                    如果不开启【持续记录】，下面所需的字段可能在刷新后丢失
                </blockquote>
            </li>
            <li>
                在【筛选】文本框中输入 "callback?"（不加引号）
                <blockquote>这将会筛选所需的请求字段</blockquote>
            </li>
            <li>
                登陆账号
                <blockquote>开发者工具会记录所有请求</blockquote>
            </li>
            <li>
                登陆成功后，开发者工具的【网络】页面会出现一个形如
                "https://app-api.pixiv.net/.../callback?state=...&code=..."的字段
            </li>
            <li>将上述字段中的"code="后的内容复制到下面的输入框中，点击提交</li>
            <li>
                获取成功后，下方会显示refresh_token，且refresh_token会被写入"./user/refresh_token.txt"
            </li>
        </ul>

        <h2>输入Code</h2>
        <input id="code-inp">
        <button id="submit">提交</button>

        <h2>refresh_token:</h2>
        <div class="rt-disp">
            <!--显示refresh_token-->
        </div>
    </main>

    <script>
        const codeInp = document.querySelector('#code-inp');
        const submitBtn = document.querySelector('#submit');
        const rtDisp = document.querySelector('#rt-disp');

        submitBtn.onclick = () => {
            fetch('/submitcode?code='+codeInp.value)
                .then(rt => {
                    let rtText = document.createElement('p');
                    rtText.innerText = rt;
                    rtDisp.appendChild(rtText);
                })
        }
    </script>

    <footer>
        <p>
            此工具修改自
            <a href="https://2heng.xin">Mashiro</a>的PixivBiu
        </p>
        <p><a href="/pixivbiulicense">LICENSE</a></p>
    </footer>
</body>
